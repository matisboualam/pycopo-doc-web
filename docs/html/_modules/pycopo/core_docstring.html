

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>pycopo.core_docstring &#8212; pycopo 0.0.1 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=12da95d707ffb74b382d" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=12da95d707ffb74b382d" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=12da95d707ffb74b382d" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=12da95d707ffb74b382d" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=12da95d707ffb74b382d" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=12da95d707ffb74b382d" />

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_modules/pycopo/core_docstring';</script>
    <link rel="shortcut icon" href="https://gitlab.com/uploads/-/system/project/avatar/15363012/6x6_1000-12.jpeg?width=64"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  <div class="navbar-header-items__start">
    
      <div class="navbar-item">
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
    
    
      
    
    
    <img src="https://gitlab.com/uploads/-/system/project/avatar/15363012/6x6_1000-12.jpeg?width=64" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="https://gitlab.com/uploads/-/system/project/avatar/15363012/6x6_1000-12.jpeg?width=64" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
    
  </div>
  
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../usage.html">
                        Usage
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../pycopo_theory.html">
                        The theory behind pycopo modules
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../modules.html">
                        Pycopo module dictionnary
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../tutorial.html">
                        Jupyter Notebook tutorial
                      </a>
                    </li>
                

                <li class="nav-item">
                  <a class="nav-link nav-external" href="https://www.univ-smb.fr/symme/">
                    SYMME
                  </a>
                </li>
                
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
        </div>
      
      
        <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://gitlab.com/symmehub/pycopo" title="GitLab" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-gitlab"></i></span>
            <label class="sr-only">GitLab</label></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
    </div>
  

  
</div>

    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../usage.html">
                        Usage
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../pycopo_theory.html">
                        The theory behind pycopo modules
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../modules.html">
                        Pycopo module dictionnary
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../tutorial.html">
                        Jupyter Notebook tutorial
                      </a>
                    </li>
                

                <li class="nav-item">
                  <a class="nav-link nav-external" href="https://www.univ-smb.fr/symme/">
                    SYMME
                  </a>
                </li>
                
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://gitlab.com/symmehub/pycopo" title="GitLab" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-gitlab"></i></span>
            <label class="sr-only">GitLab</label></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<h3><a href="../../index.html">Table of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../usage.html">Usage</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../pycopo_theory.html">The theory behind pycopo modules</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">Pycopo module dictionnary</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial.html">Jupyter Notebook tutorial</a></li>
</ul>
</div>
        <div class="sidebar-primary-item">
<div id="searchbox"></div></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumbs">
  <ul class="bd-breadcrumbs" role="navigation" aria-label="Breadcrumb">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../index.html" class="nav-link">Module code</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">pycopo.core_docstring</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <h1>Source code for pycopo.core_docstring</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">cv2</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">cv2</span> <span class="kn">import</span> <span class="n">aruco</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">optimize</span>
<span class="kn">import</span> <span class="nn">pycopo</span>


<div class="viewcode-block" id="get_corners"><a class="viewcode-back" href="../../pycopo.html#pycopo.core_docstring.get_corners">[docs]</a><span class="k">def</span> <span class="nf">get_corners</span><span class="p">(</span><span class="n">dimension</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This function generates a 3D array of the given dimension.</span>

<span class="sd">    :param dimension: The dimension of the array to generate.</span>
<span class="sd">    :type dimension: int</span>
<span class="sd">    :return: The generated array.</span>
<span class="sd">    :rtype: numpy.ndarray&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">dimension</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">dimension</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dimension</span><span class="p">)</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
        <span class="p">[[</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]]</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">d</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">c</span></div>


<div class="viewcode-block" id="detect_markers"><a class="viewcode-back" href="../../pycopo.html#pycopo.core_docstring.detect_markers">[docs]</a><span class="k">def</span> <span class="nf">detect_markers</span><span class="p">(</span>
    <span class="n">frame</span><span class="p">,</span> <span class="n">dictionary</span><span class="o">=</span><span class="n">aruco</span><span class="o">.</span><span class="n">DICT_6X6_250</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">drop_duplicates</span><span class="o">=</span><span class="kc">True</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This function detects markers in a frame and returns the corners and ids of the markers.</span>

<span class="sd">    :param frame: The frame to detect markers in.</span>
<span class="sd">    :type frame: numpy.array</span>
<span class="sd">    :param dictionary: The dictionary to use for marker detection.</span>
<span class="sd">    :type dictionary: cv2.aruco.Dictionary</span>
<span class="sd">    :param parameters: The parameters to use for marker detection.</span>
<span class="sd">    :type parameters: cv2.aruco.DetectorParameters</span>
<span class="sd">    :param drop_duplicates: Whether to drop duplicate markers.</span>
<span class="sd">    :type drop_duplicates: bool</span>
<span class="sd">    :return: A tuple containing a bool indicating whether any markers were detected, a numpy.array of marker ids, and a numpy.array of marker corners.</span>
<span class="sd">    :rtype: (bool, numpy.array, numpy.array)&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">parameters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="n">aruco</span><span class="o">.</span><span class="n">DetectorParameters</span><span class="p">()</span>
        <span class="n">parameters</span><span class="o">.</span><span class="n">cornerRefinementMethod</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="n">parameters</span><span class="o">.</span><span class="n">cornerRefinementWinSize</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">parameters</span><span class="o">.</span><span class="n">cornerRefinementMaxIterations</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="p">(</span><span class="n">corners</span><span class="p">,</span> <span class="n">ids</span><span class="p">,</span> <span class="n">rejected</span><span class="p">)</span> <span class="o">=</span> <span class="n">aruco</span><span class="o">.</span><span class="n">detectMarkers</span><span class="p">(</span>
        <span class="n">frame</span><span class="p">,</span>
        <span class="n">dictionary</span><span class="o">=</span><span class="n">aruco</span><span class="o">.</span><span class="n">getPredefinedDictionary</span><span class="p">(</span><span class="n">dictionary</span><span class="p">),</span>
        <span class="n">parameters</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">corners</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">ids</span> <span class="o">=</span> <span class="n">ids</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">corners</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">corners</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">drop_duplicates</span><span class="p">:</span>
            <span class="p">(</span><span class="n">unique</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">counts</span><span class="p">)</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
                <span class="n">ids</span><span class="p">,</span> <span class="n">return_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
            <span class="n">loc</span> <span class="o">=</span> <span class="n">index</span><span class="p">[</span><span class="n">counts</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">corners</span> <span class="o">=</span> <span class="n">corners</span><span class="p">[</span><span class="n">loc</span><span class="p">]</span>
            <span class="n">ids</span> <span class="o">=</span> <span class="n">ids</span><span class="p">[</span><span class="n">loc</span><span class="p">]</span>
            <span class="k">return</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">ids</span><span class="p">,</span> <span class="n">corners</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">marker_area</span><span class="p">(</span><span class="n">corners</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This function calculates the areas of the given corners.</span>

<span class="sd">    :param corners: The corners of the shapes.</span>
<span class="sd">    :type corners: list</span>
<span class="sd">    :return: The areas of the shapes.</span>
<span class="sd">    :rtype: list&quot;&quot;&quot;</span>
    <span class="n">Nc</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">corners</span><span class="p">)</span>
    <span class="n">areas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nc</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nc</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">corners</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">areas</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">c</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span> <span class="o">/</span> <span class="mf">2.0</span>
    <span class="k">return</span> <span class="n">areas</span>


<div class="viewcode-block" id="marker_angles"><a class="viewcode-back" href="../../pycopo.html#pycopo.core_docstring.marker_angles">[docs]</a><span class="k">def</span> <span class="nf">marker_angles</span><span class="p">(</span><span class="n">corners</span><span class="p">,</span> <span class="n">deviation</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">abs_max</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This function calculates the angles between the vertices of a cube and returns the result.</span>

<span class="sd">    :param corners: The corners of the cube.</span>
<span class="sd">    :type corners: numpy.ndarray</span>
<span class="sd">    :param deviation: Whether to calculate the deviation from 45 degrees.</span>
<span class="sd">    :type deviation: bool</span>
<span class="sd">    :param abs_max: Whether to take the absolute maximum of the angles.</span>
<span class="sd">    :type abs_max: bool</span>
<span class="sd">    :return: The angles between the vertices of the cube.</span>
<span class="sd">    :rtype: numpy.ndarray&quot;&quot;&quot;</span>
    <span class="n">Nc</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">corners</span><span class="p">)</span>
    <span class="n">angles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Nc</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="n">vertices</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vertices</span><span class="p">)):</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">vertices</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">B</span> <span class="o">=</span> <span class="n">corners</span><span class="p">[:,</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">A</span> <span class="o">=</span> <span class="n">corners</span><span class="p">[:,</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">C</span> <span class="o">=</span> <span class="n">corners</span><span class="p">[:,</span> <span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
        <span class="n">AB</span> <span class="o">=</span> <span class="n">B</span> <span class="o">-</span> <span class="n">A</span>
        <span class="n">AC</span> <span class="o">=</span> <span class="n">C</span> <span class="o">-</span> <span class="n">A</span>
        <span class="n">AB</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">AB</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[:,</span> <span class="kc">None</span><span class="p">]</span>
        <span class="n">AC</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">AC</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[:,</span> <span class="kc">None</span><span class="p">]</span>
        <span class="n">angles</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">AB</span><span class="p">,</span> <span class="n">AC</span><span class="p">)))</span>
    <span class="k">if</span> <span class="n">deviation</span><span class="p">:</span>
        <span class="n">angles</span> <span class="o">-=</span> <span class="mf">45.0</span>
    <span class="k">if</span> <span class="n">abs_max</span><span class="p">:</span>
        <span class="n">angles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">angles</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">angles</span></div>


<span class="k">def</span> <span class="nf">_cost_pnp</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">p3d</span><span class="p">,</span> <span class="n">p2dt</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">camera_matrix</span><span class="p">,</span> <span class="n">distortion_coefficients</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This function projects 3D points to 2D using a camera model.</span>

<span class="sd">    :param p3d: The 3D points to project.</span>
<span class="sd">    :type p3d: numpy.array</span>
<span class="sd">    :param rvec: The rotation vector of the camera.</span>
<span class="sd">    :type rvec: numpy.array</span>
<span class="sd">    :param tvec: The translation vector of the camera.</span>
<span class="sd">    :type tvec: numpy.array</span>
<span class="sd">    :param camera_matrix: The camera matrix of the camera.</span>
<span class="sd">    :type camera_matrix: numpy.array</span>
<span class="sd">    :param distortion_coefficients: The distortion coefficients of the camera.</span>
<span class="sd">    :type distortion_coefficients: numpy.array</span>
<span class="sd">    :return: The projected 2D points.</span>
<span class="sd">    :rtype: numpy.array&quot;&quot;&quot;</span>
    <span class="p">(</span><span class="n">rvec</span><span class="p">,</span> <span class="n">tvec</span><span class="p">)</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">proj</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">projectPoints</span><span class="p">(</span><span class="n">p3d</span><span class="p">,</span> <span class="n">rvec</span><span class="p">,</span> <span class="n">tvec</span><span class="p">,</span> <span class="n">camera_matrix</span><span class="p">,</span> <span class="n">distortion_coefficients</span><span class="p">)</span>
    <span class="n">p2dp</span> <span class="o">=</span> <span class="n">proj</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">p2dt</span> <span class="o">-</span> <span class="n">p2dp</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>


<div class="viewcode-block" id="estimate_pose"><a class="viewcode-back" href="../../pycopo.html#pycopo.core_docstring.estimate_pose">[docs]</a><span class="k">def</span> <span class="nf">estimate_pose</span><span class="p">(</span>
    <span class="n">points2D</span><span class="p">,</span>
    <span class="n">points3D</span><span class="p">,</span>
    <span class="n">camera_matrix</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span>
    <span class="n">distortion_coefficients</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span>
    <span class="n">method</span><span class="o">=</span><span class="s2">&quot;pycopo&quot;</span><span class="p">,</span>
    <span class="n">weights</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
    <span class="n">rvec0</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]),</span>
    <span class="n">tvec0</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]),</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This function calculates the pose of a composite object using the solvePnP function from the cv2 library or the pycopo library.</span>

<span class="sd">    :param points3D: A list of 3D points corresponding to the points in the image.</span>
<span class="sd">    :type points3D: list</span>
<span class="sd">    :param points2D: A list of 2D points corresponding to the points in the image.</span>
<span class="sd">    :type points2D: list</span>
<span class="sd">    :param camera_matrix: The camera matrix used to calculate the pose.</span>
<span class="sd">    :type camera_matrix: numpy.ndarray</span>
<span class="sd">    :param distortion_coefficients: The distortion coefficients used to calculate the pose.</span>
<span class="sd">    :type distortion_coefficients: numpy.ndarray</span>
<span class="sd">    :param method: The method used to calculate the pose, either &#39;cv2&#39; or &#39;pycopo&#39;.</span>
<span class="sd">    :type method: str</span>
<span class="sd">    :param rvec0: The initial rotation vector used when calculating the pose with the &#39;pycopo&#39; method.</span>
<span class="sd">    :type rvec0: numpy.ndarray</span>
<span class="sd">    :param tvec0: The initial translation vector used when calculating the pose with the &#39;pycopo&#39; method.</span>
<span class="sd">    :type tvec0: numpy.ndarray</span>
<span class="sd">    :param weights: The weights used when calculating the pose with the &#39;pycopo&#39; method.</span>
<span class="sd">    :type weights: numpy.ndarray</span>
<span class="sd">    :param kwargs: Any additional keyword arguments used when calculating the pose with the &#39;pycopo&#39; method.</span>
<span class="sd">    :type kwargs: dict</span>
<span class="sd">    :return: A tuple containing a boolean indicating whether or not the pose was successfully calculated, the rotation vector, the translation vector, and the result of the optimization (only returned when the &#39;pycopo&#39; method is used).</span>
<span class="sd">    :rtype: tuple&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;cv2&quot;</span><span class="p">:</span>
        <span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="n">rvec</span><span class="p">,</span> <span class="n">tvec</span><span class="p">)</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">solvePnP</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">points3D</span><span class="p">),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">points2D</span><span class="p">),</span>
            <span class="n">camera_matrix</span><span class="p">,</span>
            <span class="n">distortion_coefficients</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">ret</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">rvec</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">tvec</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;pycopo&quot;</span><span class="p">:</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span>
        <span class="n">p3d</span> <span class="o">=</span> <span class="n">points3D</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span>
        <span class="n">p2dt</span> <span class="o">=</span> <span class="n">points2D</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">weights</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="n">weights</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span>
        <span class="n">X0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">rvec0</span><span class="p">,</span> <span class="n">tvec0</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span>
        <span class="n">sol</span> <span class="o">=</span> <span class="n">optimize</span><span class="o">.</span><span class="n">least_squares</span><span class="p">(</span>
            <span class="n">_cost_pnp</span><span class="p">,</span>
            <span class="n">X0</span><span class="p">,</span>
            <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">p3d</span><span class="p">,</span> <span class="n">p2dt</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">camera_matrix</span><span class="p">,</span> <span class="n">distortion_coefficients</span><span class="p">),</span>
            <span class="n">method</span><span class="o">=</span><span class="s2">&quot;lm&quot;</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">sol</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">sol</span><span class="p">)</span>
        <span class="p">(</span><span class="n">srvec</span><span class="p">,</span> <span class="n">stvec</span><span class="p">)</span> <span class="o">=</span> <span class="n">sol</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">srvec</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">angle</span> <span class="o">&gt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">:</span>
            <span class="n">angle</span> <span class="o">-=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="n">srvec</span> <span class="o">=</span> <span class="n">srvec</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">srvec</span><span class="p">)</span>
        <span class="n">srvec</span> <span class="o">=</span> <span class="n">srvec</span> <span class="o">*</span> <span class="n">angle</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">stvec</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">srvec</span> <span class="o">*=</span> <span class="n">s</span>
        <span class="n">stvec</span> <span class="o">*=</span> <span class="n">s</span>
        <span class="k">return</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">srvec</span><span class="p">,</span> <span class="n">stvec</span><span class="p">,</span> <span class="n">sol</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Composite object can&#39;t be found !&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></div>


<div class="viewcode-block" id="estimate_pose_planar"><a class="viewcode-back" href="../../pycopo.html#pycopo.core_docstring.estimate_pose_planar">[docs]</a><span class="k">def</span> <span class="nf">estimate_pose_planar</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This function estimates the pose of an object using the pycopo algorithm.</span>

<span class="sd">    :param args: The arguments to be passed to the estimate_pose function.</span>
<span class="sd">    :type args: tuple</span>
<span class="sd">    :param kwargs: The keyword arguments to be passed to the estimate_pose function.</span>
<span class="sd">    :type kwargs: dict</span>
<span class="sd">    :return: The success code, the rotation vector and translation vector of the first pose estimation, the rotation vector and translation vector of the second pose estimation, the solution of the first pose estimation, and the solution of the second pose estimation.</span>
<span class="sd">    :rtype: tuple&quot;&quot;&quot;</span>
    <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;method&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;pycopo&quot;</span>
    <span class="p">(</span><span class="n">success0</span><span class="p">,</span> <span class="n">rvec0</span><span class="p">,</span> <span class="n">tvec0</span><span class="p">,</span> <span class="n">sol0</span><span class="p">)</span> <span class="o">=</span> <span class="n">estimate_pose</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">success0</span><span class="p">:</span>
        <span class="n">Pt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">tvec0</span><span class="p">,</span> <span class="n">tvec0</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">tvec0</span><span class="p">,</span> <span class="n">tvec0</span><span class="p">)</span>
        <span class="n">rvec1_guess</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">Pt</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">rvec0</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;rvec0&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rvec1_guess</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;tvec0&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tvec0</span>
        <span class="p">(</span><span class="n">success1</span><span class="p">,</span> <span class="n">rvec1</span><span class="p">,</span> <span class="n">tvec1</span><span class="p">,</span> <span class="n">sol1</span><span class="p">)</span> <span class="o">=</span> <span class="n">estimate_pose</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">success1</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">rvec0</span><span class="p">,</span> <span class="n">tvec0</span><span class="p">,</span> <span class="n">rvec1</span><span class="p">,</span> <span class="n">tvec1</span><span class="p">,</span> <span class="n">sol0</span><span class="p">,</span> <span class="n">sol1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="mi">1</span><span class="p">,</span>
                <span class="n">rvec0</span><span class="p">,</span>
                <span class="n">tvec0</span><span class="p">,</span>
                <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
                <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
                <span class="n">sol0</span><span class="p">,</span>
                <span class="kc">None</span><span class="p">,</span>
            <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="mi">2</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
            <span class="kc">None</span><span class="p">,</span>
            <span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="estimate_pose_composite"><a class="viewcode-back" href="../../pycopo.html#pycopo.core_docstring.estimate_pose_composite">[docs]</a><span class="k">def</span> <span class="nf">estimate_pose_composite</span><span class="p">(</span>
    <span class="n">ids2D</span><span class="p">,</span>
    <span class="n">points2D</span><span class="p">,</span>
    <span class="n">ids3D</span><span class="p">,</span>
    <span class="n">points3D</span><span class="p">,</span>
    <span class="n">camera_matrix</span><span class="p">,</span>
    <span class="n">distortion_coefficients</span><span class="p">,</span>
    <span class="n">rvec0</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]),</span>
    <span class="n">tvec0</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]),</span>
    <span class="n">weights</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This function intersects two arrays and returns the result.</span>

<span class="sd">    :param num1: The first array to intersect.</span>
<span class="sd">    :type num1: array</span>
<span class="sd">    :param num2: The second array to intersect.</span>
<span class="sd">    :type num2: array</span>
<span class="sd">    :return: The intersection of num1 and num2.</span>
<span class="sd">    :rtype: array&quot;&quot;&quot;</span>
    <span class="p">(</span><span class="n">inter</span><span class="p">,</span> <span class="n">loc3D</span><span class="p">,</span> <span class="n">loc2D</span><span class="p">)</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">ids3D</span><span class="p">,</span> <span class="n">ids2D</span><span class="p">,</span> <span class="n">return_indices</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">p3d</span> <span class="o">=</span> <span class="n">points3D</span><span class="p">[</span><span class="n">loc3D</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">p2d</span> <span class="o">=</span> <span class="n">points2D</span><span class="p">[</span><span class="n">loc2D</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="p">(</span><span class="n">success</span><span class="p">,</span> <span class="n">rvec</span><span class="p">,</span> <span class="n">tvec</span><span class="p">,</span> <span class="n">sol</span><span class="p">)</span> <span class="o">=</span> <span class="n">estimate_pose</span><span class="p">(</span>
        <span class="n">points2D</span><span class="o">=</span><span class="n">p2d</span><span class="p">,</span>
        <span class="n">points3D</span><span class="o">=</span><span class="n">p3d</span><span class="p">,</span>
        <span class="n">camera_matrix</span><span class="o">=</span><span class="n">camera_matrix</span><span class="p">,</span>
        <span class="n">distortion_coefficients</span><span class="o">=</span><span class="n">distortion_coefficients</span><span class="p">,</span>
        <span class="n">method</span><span class="o">=</span><span class="s2">&quot;pycopo&quot;</span><span class="p">,</span>
        <span class="n">rvec0</span><span class="o">=</span><span class="n">rvec0</span><span class="p">,</span>
        <span class="n">tvec0</span><span class="o">=</span><span class="n">tvec0</span><span class="p">,</span>
        <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">success</span><span class="p">,</span> <span class="n">rvec</span><span class="p">,</span> <span class="n">tvec</span><span class="p">,</span> <span class="n">sol</span><span class="p">)</span></div>


<div class="viewcode-block" id="estimate_pose_composite_planar"><a class="viewcode-back" href="../../pycopo.html#pycopo.core_docstring.estimate_pose_composite_planar">[docs]</a><span class="k">def</span> <span class="nf">estimate_pose_composite_planar</span><span class="p">(</span>
    <span class="n">ids2D</span><span class="p">,</span>
    <span class="n">points2D</span><span class="p">,</span>
    <span class="n">ids3D</span><span class="p">,</span>
    <span class="n">points3D</span><span class="p">,</span>
    <span class="n">camera_matrix</span><span class="p">,</span>
    <span class="n">distortion_coefficients</span><span class="p">,</span>
    <span class="n">weights</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This function estimates the pose of a 3D object given its 2D ids and points.</span>

<span class="sd">    :param ids2D: The 2D ids of the object.</span>
<span class="sd">    :type ids2D: int</span>
<span class="sd">    :param points2D: The 2D points of the object.</span>
<span class="sd">    :type points2D: float</span>
<span class="sd">    :param ids3D: The 3D ids of the object.</span>
<span class="sd">    :type ids3D: int</span>
<span class="sd">    :param points3D: The 3D points of the object.</span>
<span class="sd">    :type points3D: float</span>
<span class="sd">    :param camera_matrix: The camera matrix.</span>
<span class="sd">    :type camera_matrix: float</span>
<span class="sd">    :param distortion_coefficients: The distortion coefficients.</span>
<span class="sd">    :type distortion_coefficients: float</span>
<span class="sd">    :param rvec0: The initial rotation vector.</span>
<span class="sd">    :type rvec0: float</span>
<span class="sd">    :param tvec0: The initial translation vector.</span>
<span class="sd">    :type tvec0: float</span>
<span class="sd">    :param weights: The weights.</span>
<span class="sd">    :type weights: float</span>
<span class="sd">    :return: The estimated pose of the object.</span>
<span class="sd">    :rtype: (bool, float, float, float)&quot;&quot;&quot;</span>
    <span class="p">(</span><span class="n">success0</span><span class="p">,</span> <span class="n">rvec0</span><span class="p">,</span> <span class="n">tvec0</span><span class="p">,</span> <span class="n">sol0</span><span class="p">)</span> <span class="o">=</span> <span class="n">estimate_pose_composite</span><span class="p">(</span>
        <span class="n">ids2D</span><span class="p">,</span> <span class="n">points2D</span><span class="p">,</span> <span class="n">ids3D</span><span class="p">,</span> <span class="n">points3D</span><span class="p">,</span> <span class="n">camera_matrix</span><span class="p">,</span> <span class="n">distortion_coefficients</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">success0</span><span class="p">:</span>
        <span class="n">Pt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">tvec0</span><span class="p">,</span> <span class="n">tvec0</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">tvec0</span><span class="p">,</span> <span class="n">tvec0</span><span class="p">)</span>
        <span class="n">rvec1_guess</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">Pt</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">rvec0</span><span class="p">)</span>
        <span class="p">(</span><span class="n">success1</span><span class="p">,</span> <span class="n">rvec1</span><span class="p">,</span> <span class="n">tvec1</span><span class="p">,</span> <span class="n">sol1</span><span class="p">)</span> <span class="o">=</span> <span class="n">estimate_pose_composite</span><span class="p">(</span>
            <span class="n">ids2D</span><span class="o">=</span><span class="n">ids2D</span><span class="p">,</span>
            <span class="n">points2D</span><span class="o">=</span><span class="n">points2D</span><span class="p">,</span>
            <span class="n">ids3D</span><span class="o">=</span><span class="n">ids3D</span><span class="p">,</span>
            <span class="n">points3D</span><span class="o">=</span><span class="n">points3D</span><span class="p">,</span>
            <span class="n">camera_matrix</span><span class="o">=</span><span class="n">camera_matrix</span><span class="p">,</span>
            <span class="n">distortion_coefficients</span><span class="o">=</span><span class="n">distortion_coefficients</span><span class="p">,</span>
            <span class="n">rvec0</span><span class="o">=</span><span class="n">rvec1_guess</span><span class="p">,</span>
            <span class="n">tvec0</span><span class="o">=</span><span class="n">tvec0</span><span class="p">,</span>
            <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">success1</span> <span class="ow">and</span> <span class="n">sol0</span><span class="o">.</span><span class="n">cost</span> <span class="o">&lt;</span> <span class="n">sol1</span><span class="o">.</span><span class="n">cost</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">success1</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">rvec0</span><span class="p">,</span> <span class="n">tvec0</span><span class="p">,</span> <span class="n">sol0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">rvec1</span><span class="p">,</span> <span class="n">tvec1</span><span class="p">,</span> <span class="n">sol1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></div>


<div class="viewcode-block" id="marker_area"><a class="viewcode-back" href="../../pycopo.html#pycopo.core_docstring.marker_area">[docs]</a><span class="k">def</span> <span class="nf">marker_area</span><span class="p">(</span><span class="n">points2D</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This function calculates the area of a 2D polygon.</span>

<span class="sd">    :param points2D: The points of the polygon.</span>
<span class="sd">    :type points2D: numpy.array</span>
<span class="sd">    :return: The area of the polygon.</span>
<span class="sd">    :rtype: float&quot;&quot;&quot;</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">points2D</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">points2D</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">p</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">p</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]))</span> <span class="o">/</span> <span class="mi">2</span></div>


<div class="viewcode-block" id="Container"><a class="viewcode-back" href="../../pycopo.html#pycopo.core_docstring.Container">[docs]</a><span class="k">class</span> <span class="nc">Container</span><span class="p">:</span>
<div class="viewcode-block" id="Container.copy"><a class="viewcode-back" href="../../pycopo.html#pycopo.core_docstring.Container.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function returns a deep copy of the object.</span>

<span class="sd">        :param self: The object to be copied.</span>
<span class="sd">        :type self: object</span>
<span class="sd">        :return: A deep copy of the object.</span>
<span class="sd">        :rtype: object&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="save_composite"><a class="viewcode-back" href="../../pycopo.html#pycopo.core_docstring.save_composite">[docs]</a><span class="k">def</span> <span class="nf">save_composite</span><span class="p">(</span><span class="n">composite</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This function takes in a composite object, converts it to a JSON string, and writes it to a file.</span>

<span class="sd">    :param composite: The composite object to convert to JSON.</span>
<span class="sd">    :type composite: obj</span>
<span class="sd">    :param path: The file path to write the JSON string to.</span>
<span class="sd">    :type path: str</span>
<span class="sd">    :return: The JSON string representation of the composite object.</span>
<span class="sd">    :rtype: str&quot;&quot;&quot;</span>
    <span class="n">out</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;ids&quot;</span><span class="p">:</span> <span class="n">composite</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">tolist</span><span class="p">()}</span>
    <span class="n">out</span><span class="p">[</span><span class="s2">&quot;rvecs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">composite</span><span class="o">.</span><span class="n">rvecs</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">out</span><span class="p">[</span><span class="s2">&quot;tvecs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">composite</span><span class="o">.</span><span class="n">tvecs</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">out</span><span class="p">[</span><span class="s2">&quot;dimensions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">composite</span><span class="o">.</span><span class="n">dimensions</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">out</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">composite</span><span class="o">.</span><span class="n">label</span>
    <span class="n">outs</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">outs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">outs</span></div>


<div class="viewcode-block" id="load_composite"><a class="viewcode-back" href="../../pycopo.html#pycopo.core_docstring.load_composite">[docs]</a><span class="k">def</span> <span class="nf">load_composite</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;&quot;&quot;&quot;</span>

<span class="sd">    def json_loads(path):</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        Loads a JSON file and returns the data.</span>

<span class="sd">        :param path: The path to the JSON file.</span>
<span class="sd">        :type path: str</span>
<span class="sd">        :return: The data from the JSON file.</span>
<span class="sd">        :rtype: dict</span>
<span class="sd">        &quot;&quot;&quot;&#39;&#39;&#39;</span>
    <span class="n">dic</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">CompositeMarker</span><span class="p">(</span><span class="o">**</span><span class="n">dic</span><span class="p">)</span></div>


<div class="viewcode-block" id="CompositeMarker"><a class="viewcode-back" href="../../pycopo.html#pycopo.core_docstring.CompositeMarker">[docs]</a><span class="k">class</span> <span class="nc">CompositeMarker</span><span class="p">(</span><span class="n">Container</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ids</span><span class="p">,</span> <span class="n">dimensions</span><span class="p">,</span> <span class="n">rvecs</span><span class="p">,</span> <span class="n">tvecs</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function initializes the calibration data.</span>

<span class="sd">        :param ids: The ids of the calibration objects.</span>
<span class="sd">        :type ids: np.array</span>
<span class="sd">        :param dimensions: The dimensions of the calibration objects.</span>
<span class="sd">        :type dimensions: np.array</span>
<span class="sd">        :param rvecs: The rotation vectors of the calibration objects.</span>
<span class="sd">        :type rvecs: np.array</span>
<span class="sd">        :param tvecs: The translation vectors of the calibration objects.</span>
<span class="sd">        :type tvecs: np.array</span>
<span class="sd">        :param label: The label of the calibration objects.</span>
<span class="sd">        :type label: str&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ids</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dimensions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dimensions</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rvecs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rvecs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tvecs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tvecs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">label</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function returns a Pycopo Composite Marker with a certain number of markers.</span>

<span class="sd">        :param len: The number of markers.</span>
<span class="sd">        :type len: int</span>
<span class="sd">        :return: The Pycopo Composite Marker.</span>
<span class="sd">        :rtype: Pycopo Composite Marker&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;&lt;Pycopo Composite Marker w. </span><span class="si">{0}</span><span class="s2"> markers&gt;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ids</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function returns the string &#39;Pycopo Composite Marker\\n&#39; concatenated with the result of the __str__() method of the as_dataframe() method.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;Pycopo Composite Marker</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">as_dataframe</span><span class="p">()</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_update__dict__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dic</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function updates the dictionary with the provided key-value pairs.</span>

<span class="sd">        :param dic: The dictionary to update.</span>
<span class="sd">        :type dic: dict</span>
<span class="sd">        :return: The updated dictionary.</span>
<span class="sd">        :rtype: dict&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">dic</span><span class="p">)</span>

<div class="viewcode-block" id="CompositeMarker.as_dataframe"><a class="viewcode-back" href="../../pycopo.html#pycopo.core_docstring.CompositeMarker.as_dataframe">[docs]</a>    <span class="k">def</span> <span class="nf">as_dataframe</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function returns a pandas DataFrame with the marker dimensions, rotation vectors, and translation vectors.</span>

<span class="sd">        :param ids: The marker IDs.</span>
<span class="sd">        :type ids: list</span>
<span class="sd">        :param dimensions: The marker dimensions.</span>
<span class="sd">        :type dimensions: list</span>
<span class="sd">        :param rvecs: The marker rotation vectors.</span>
<span class="sd">        :type rvecs: list</span>
<span class="sd">        :param tvecs: The marker translation vectors.</span>
<span class="sd">        :type tvecs: list</span>
<span class="sd">        :return: A pandas DataFrame with the marker dimensions, rotation vectors, and translation vectors.</span>
<span class="sd">        :rtype: pandas.DataFrame&quot;&quot;&quot;</span>
        <span class="n">ddimensions</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ids</span><span class="p">,</span>
            <span class="n">columns</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_product</span><span class="p">([[</span><span class="s2">&quot;dimension&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]]),</span>
            <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dimensions</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">drvecs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ids</span><span class="p">,</span>
            <span class="n">columns</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_product</span><span class="p">([[</span><span class="s2">&quot;rvec&quot;</span><span class="p">],</span> <span class="nb">list</span><span class="p">(</span><span class="s2">&quot;xyz&quot;</span><span class="p">)]),</span>
            <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rvecs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">dtvecs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ids</span><span class="p">,</span>
            <span class="n">columns</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_product</span><span class="p">([[</span><span class="s2">&quot;tvec&quot;</span><span class="p">],</span> <span class="nb">list</span><span class="p">(</span><span class="s2">&quot;xyz&quot;</span><span class="p">)]),</span>
            <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tvecs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">ddimensions</span><span class="p">,</span> <span class="n">drvecs</span><span class="p">,</span> <span class="n">dtvecs</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;marker&quot;</span>
        <span class="k">return</span> <span class="n">data</span></div>

<div class="viewcode-block" id="CompositeMarker.p3d"><a class="viewcode-back" href="../../pycopo.html#pycopo.core_docstring.CompositeMarker.p3d">[docs]</a>    <span class="k">def</span> <span class="nf">p3d</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function calculates the 3D coordinates of the corners of the marker with ID self.ids.</span>

<span class="sd">        :param self: The marker object.</span>
<span class="sd">        :type self: Marker</span>
<span class="sd">        :return: The 3D coordinates of the corners of the marker.</span>
<span class="sd">        :rtype: np.array&quot;&quot;&quot;</span>
        <span class="n">Nm</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ids</span><span class="p">)</span>
        <span class="n">p3di</span> <span class="o">=</span> <span class="n">get_corners</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dimensions</span><span class="p">)</span>
        <span class="n">p3dc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">p3di</span><span class="p">)</span>
        <span class="n">rvecs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rvecs</span>
        <span class="n">tvecs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tvecs</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nm</span><span class="p">):</span>
            <span class="n">p3dc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">pycopo</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">apply_RT</span><span class="p">(</span><span class="n">p3di</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">rvecs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">tvecs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">p3dc</span></div>

<div class="viewcode-block" id="CompositeMarker.apply_RT"><a class="viewcode-back" href="../../pycopo.html#pycopo.core_docstring.CompositeMarker.apply_RT">[docs]</a>    <span class="k">def</span> <span class="nf">apply_RT</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">T</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function copies the given pose and applies the given rotation and translation to it.</span>

<span class="sd">        :param pose: The pose to copy and transform.</span>
<span class="sd">        :type pose: pycopo.Pose</span>
<span class="sd">        :param R: The 3x3 rotation matrix to apply.</span>
<span class="sd">        :type R: numpy.ndarray</span>
<span class="sd">        :param T: The 3x1 translation vector to apply.</span>
<span class="sd">        :type T: numpy.ndarray</span>
<span class="sd">        :param inplace: Whether to perform the transformation in place or return a new pose.</span>
<span class="sd">        :type inplace: bool</span>
<span class="sd">        :return: The transformed pose. If inplace is True, this is the same object as pose. Otherwise, it is a new pose object.</span>
<span class="sd">        :rtype: pycopo.Pose&quot;&quot;&quot;</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">inplace</span> <span class="k">else</span> <span class="bp">self</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">R</span><span class="p">)</span>
        <span class="n">T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
        <span class="n">rvecs</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">rvecs</span>
        <span class="n">tvecs</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">tvecs</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rvecs</span><span class="p">)):</span>
            <span class="p">(</span><span class="n">rvecs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">tvecs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">=</span> <span class="n">pycopo</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">compose_RT</span><span class="p">(</span><span class="n">rvecs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">tvecs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">R</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">inplace</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="CompositeMarker.project"><a class="viewcode-back" href="../../pycopo.html#pycopo.core_docstring.CompositeMarker.project">[docs]</a>    <span class="k">def</span> <span class="nf">project</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">rvecs</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span>
        <span class="n">tvecs</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span>
        <span class="n">cameraMatrix</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span>
        <span class="n">distortionCoefficients</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function projects 3D points into 2D image plane given intrinsic and extrinsic parameters.</span>

<span class="sd">        :param rvecs: Rotation vectors. Each vector is 1x3 and describes the rotation of the corresponding 3D point around the origin.</span>
<span class="sd">        :type rvecs: numpy.array</span>
<span class="sd">        :param tvecs: Translation vectors. Each vector is 1x3 and describes the translation of the corresponding 3D point from the origin.</span>
<span class="sd">        :type tvecs: numpy.array</span>
<span class="sd">        :param cameraMatrix: Camera matrix. 3x3 numpy.array.</span>
<span class="sd">        :type cameraMatrix: numpy.array</span>
<span class="sd">        :param distortionCoefficients: Distortion coefficients. 5x1 numpy.array.</span>
<span class="sd">        :type distortionCoefficients: numpy.array</span>
<span class="sd">        :return: Projected 2D points. Ni x Nm x 4 x 2 numpy.array, where Ni is the number of input 3D points, Nm is the number of 2D points in the image plane, and 4 is the number of corners of the marker.</span>
<span class="sd">        :rtype: numpy.array&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rvecs</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">rvecs</span> <span class="o">=</span> <span class="n">rvecs</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="n">tvecs</span> <span class="o">=</span> <span class="n">tvecs</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="n">concat</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">p3d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p3d</span><span class="p">()</span>
        <span class="n">Ni</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rvecs</span><span class="p">)</span>
        <span class="n">Nm</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">p3d</span><span class="p">)</span>
        <span class="n">p3dconc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">p3d</span><span class="p">)</span>
        <span class="n">p2dp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Ni</span><span class="p">,</span> <span class="n">Nm</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">im</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ni</span><span class="p">):</span>
            <span class="n">projectedPoints</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">projectPoints</span><span class="p">(</span>
                <span class="n">p3dconc</span><span class="p">,</span> <span class="n">rvecs</span><span class="p">[</span><span class="n">im</span><span class="p">],</span> <span class="n">tvecs</span><span class="p">[</span><span class="n">im</span><span class="p">],</span> <span class="n">cameraMatrix</span><span class="p">,</span> <span class="n">distortionCoefficients</span>
            <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">p2dp</span><span class="p">[</span><span class="n">im</span><span class="p">]</span> <span class="o">=</span> <span class="n">projectedPoints</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Nm</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">p2dp</span></div>

<div class="viewcode-block" id="CompositeMarker.estimate_pose"><a class="viewcode-back" href="../../pycopo.html#pycopo.core_docstring.CompositeMarker.estimate_pose">[docs]</a>    <span class="k">def</span> <span class="nf">estimate_pose</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">ids2D</span><span class="p">,</span>
        <span class="n">points2D</span><span class="p">,</span>
        <span class="n">cameraMatrix</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span>
        <span class="n">distortionCoefficients</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function estimates the pose of a composite object using 2D and 3D point correspondences.</span>

<span class="sd">        :param args: The 2D and 3D point correspondences.</span>
<span class="sd">        :type args: tuple</span>
<span class="sd">        :param ids2D: The IDs of the 2D points.</span>
<span class="sd">        :type ids2D: list</span>
<span class="sd">        :param points2D: The 2D points.</span>
<span class="sd">        :type points2D: list</span>
<span class="sd">        :param ids3D: The IDs of the 3D points.</span>
<span class="sd">        :type ids3D: list</span>
<span class="sd">        :param points3D: The 3D points.</span>
<span class="sd">        :type points3D: list</span>
<span class="sd">        :param camera_matrix: The camera matrix.</span>
<span class="sd">        :type camera_matrix: numpy.ndarray</span>
<span class="sd">        :param distortion_coefficients: The distortion coefficients.</span>
<span class="sd">        :type distortion_coefficients: numpy.ndarray</span>
<span class="sd">        :return: The estimated pose of the composite object.</span>
<span class="sd">        :rtype: numpy.ndarray&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">estimate_pose_composite</span><span class="p">(</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span>
            <span class="n">ids2D</span><span class="o">=</span><span class="n">ids2D</span><span class="p">,</span>
            <span class="n">points2D</span><span class="o">=</span><span class="n">points2D</span><span class="p">,</span>
            <span class="n">ids3D</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
            <span class="n">points3D</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">p3d</span><span class="p">(),</span>
            <span class="n">camera_matrix</span><span class="o">=</span><span class="n">cameraMatrix</span><span class="p">,</span>
            <span class="n">distortion_coefficients</span><span class="o">=</span><span class="n">distortionCoefficients</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="CompositeMarker.save"><a class="viewcode-back" href="../../pycopo.html#pycopo.core_docstring.CompositeMarker.save">[docs]</a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function saves the composite image to the specified path.</span>

<span class="sd">        :param path: The path to save the composite image.</span>
<span class="sd">        :type path: str</span>
<span class="sd">        :return: The path to the saved composite image.</span>
<span class="sd">        :rtype: str&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">save_composite</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span></div>

<div class="viewcode-block" id="CompositeMarker.set_marker_reference"><a class="viewcode-back" href="../../pycopo.html#pycopo.core_docstring.CompositeMarker.set_marker_reference">[docs]</a>    <span class="k">def</span> <span class="nf">set_marker_reference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mk_ref</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function inverts the RT of a given marker and returns the result.</span>

<span class="sd">        :param mk_ref: The marker to invert the RT of.</span>
<span class="sd">        :type mk_ref: int</span>
<span class="sd">        :param inplace: Whether to apply the RT inplace or not.</span>
<span class="sd">        :type inplace: bool</span>
<span class="sd">        :return: The inverted RT of the given marker.</span>
<span class="sd">        :rtype: int&quot;&quot;&quot;</span>
        <span class="n">Rr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">as_dataframe</span><span class="p">()</span><span class="o">.</span><span class="n">rvec</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mk_ref</span><span class="p">])</span>
        <span class="n">Tr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">as_dataframe</span><span class="p">()</span><span class="o">.</span><span class="n">tvec</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mk_ref</span><span class="p">])</span>
        <span class="p">(</span><span class="n">Rri</span><span class="p">,</span> <span class="n">Tri</span><span class="p">)</span> <span class="o">=</span> <span class="n">pycopo</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">invert_RT</span><span class="p">(</span><span class="n">R</span><span class="o">=</span><span class="n">Rr</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">Tr</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_RT</span><span class="p">(</span><span class="n">R</span><span class="o">=</span><span class="n">Rri</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">Tri</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="n">inplace</span><span class="p">)</span></div></div>
</pre></div>

                </article>
              
              
              
                <footer class="bd-footer-article">
                  <!-- Previous / next buttons -->
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            <div class="bd-footer-content__inner"></div>
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=12da95d707ffb74b382d"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=12da95d707ffb74b382d"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">
  <p class="copyright">
    
       Copyright 2023, matis.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">
  <p class="sphinx-version">
    Created using <a href="https://sphinx-doc.org/">Sphinx</a> 5.0.2.
    <br/>
  </p>
</div>
      
    </div>
  
  
    <div class="footer-items__end">
      
        <div class="footer-item"><p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.13.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>